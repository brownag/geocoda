% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/diagnostics_assessment.R
\name{gc_apply_anamorphosis}
\alias{gc_apply_anamorphosis}
\title{Apply Normal-Score (Anamorphosis) Transform}
\usage{
gc_apply_anamorphosis(
  sim_ilr_values,
  ref_ilr_values,
  despike = TRUE,
  despike_threshold = NULL
)
}
\arguments{
\item{sim_ilr_values}{Matrix of simulated ILR values in normal space (from SGS).}

\item{ref_ilr_values}{Matrix of reference (original) ILR values used to estimate
the anamorphosis function.}

\item{despike}{Logical. If \code{TRUE} (default), apply empirical despiking to remove
extreme values that may arise from the tail of the transform.}

\item{despike_threshold}{Numeric. Threshold for despiking (default 1.5 times the
range of reference data).}
}
\value{
A matrix of back-transformed values in the same space as the reference data.
}
\description{
Transform simulated values back from normal space to data space when the original
ILR values deviate from Gaussianity. This preserves the statistical properties of
the original data distribution while maintaining spatial correlation structure.
}
\details{
\strong{Methodology}:
The anamorphosis transform is implemented via empirical quantile matching:
\enumerate{
\item Compute quantiles of reference data (original)
\item Compute quantiles of simulated data (normal space)
\item Match simulated quantiles to reference quantiles (inverse transform)
\item Interpolate for values between quantiles
\item Optionally despike extreme values
}

\strong{Despiking}:
When simulations produce extreme values in the tail of the normal distribution,
the back-transform may produce unrealistic values outside the range of the
reference data. Despiking caps these values at the reference range bounds.
}
\examples{
\dontrun{
# Simulate ILR values (assume from SGS)
sim_values <- matrix(rnorm(100, 0, 1), ncol = 2)

# Reference data (original ILR values)
ref_values <- matrix(rnorm(50, 0.1, 0.9), ncol = 2)

# Apply anamorphosis back-transform
back_transformed <- gc_apply_anamorphosis(sim_values, ref_values)
print(range(back_transformed))
}

}
