% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_pipeline.R
\name{gc_apply_covariate_trend}
\alias{gc_apply_covariate_trend}
\title{Apply Covariate Trend Surface to Simulation}
\usage{
gc_apply_covariate_trend(
  x,
  component_names,
  covariates,
  covariate_names = NULL,
  trend_method = "simple"
)
}
\arguments{
\item{x}{A \code{terra::SpatRaster} containing sample data with component layers
(e.g., sand, silt, clay)}

\item{component_names}{Character vector, names of compositional layers in x}

\item{covariates}{A \code{terra::SpatRaster} with auxiliary variable layers
(e.g., elevation, slope, parent_material_class)}

\item{covariate_names}{Character vector, names of covariate layers to use
(must be subset of names(covariates))}

\item{trend_method}{Character, method for incorporating covariates:
\itemize{
\item "simple": Compute per-component linear regressions against covariates (default)
\item "local": Use local polynomial regression (loess) for nonlinear trends
\item "categorical": Stratify by covariate classes and compute per-class means
}}
}
\value{
A list with elements:
\itemize{
\item \code{detrended_raster}: New raster with residuals after removing trend
\item \code{trend_surfaces}: Raster stack of predicted trend surfaces per component
\item \code{regressions}: Summary of linear trend coefficients (if trend_method = "simple")
\item \code{metadata}: Processing metadata
}
}
\description{
Incorporate auxiliary variables (elevation, parent material, slope, etc.) as
trend surfaces in ILR-transformed compositional data. Useful for capturing
deterministic spatial patterns in soil properties related to landscape position.
}
\details{
The function fits a regression of each component against the covariates,
then subtracts the predicted values to produce detrended residuals. These
residuals should be more stationary and suitable for kriging.

Common workflow:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{# Detrend compositional data using elevation
detrended <- gc_apply_covariate_trend(
  x = sample_compositions,
  component_names = c("sand", "silt", "clay"),
  covariates = elevation_raster,
  covariate_names = "elevation",
  trend_method = "simple"
)

# Perform simulation on detrended residuals
residual_sim <- gc_sim_composition(model, domain, nsim = 100, data = detrended$detrended_raster)

# Add trend back to simulations
trend_surface <- terra::extract(detrended$trend_surfaces, prediction_points)
final_sim <- residual_sim + trend_surface
}\if{html}{\out{</div>}}
}
