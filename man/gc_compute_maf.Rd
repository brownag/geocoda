% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/maf_transform.R
\name{gc_compute_maf}
\alias{gc_compute_maf}
\title{Compute Minimum/Maximum Autocorrelation Factors (MAF) Rotation}
\usage{
gc_compute_maf(ilr_params, variogram_models, lag_h = NULL, method = "ilr")
}
\arguments{
\item{ilr_params}{List from \code{\link[=gc_ilr_params]{gc_ilr_params()}} containing mean, cov, names}

\item{variogram_models}{List of fitted gstat vgm objects (one per ILR dimension)}

\item{lag_h}{Distance for MAF computation. If NULL, defaults to mean_range/3}

\item{method}{Character: "ilr" (apply to ILR coordinates, default) or reserved for future use}
}
\value{
List with components:
\itemize{
\item \code{rotation_matrix}: D×D rotation matrix for transforming to MAF space
\item \code{eigenvalues}: Vector of eigenvalues ordered by decreasing autocorrelation
\item \code{lag_h}: Distance used for computation
\item \code{method}: Method used ("ilr")
\item \code{pca_matrix}: Lag-0 PCA transformation matrix (internal use)
}
}
\description{
Compute the MAF rotation matrix from ILR covariance and spatial structure.
MAF decorrelates multivariate data at a specified spatial lag, ordering factors
by decreasing spatial autocorrelation (high autocorrelation → low autocorrelation).
}
\details{
\strong{Two-stage decorrelation process:}
\enumerate{
\item \strong{Stage 1 - PCA at lag 0}: Decorrelate collocated values
\itemize{
\item Compute eigendecomposition of ILR covariance Σ(0)
\item Standardize: Y = Σ(0)^(-1/2) (X - μ)
}
\item \strong{Stage 2 - MAF at lag h}: Diagonalize spatial structure
\itemize{
\item Build covariance matrix at lag h: C(h)
\item Compute semivariogram matrix: Γ(h) = Σ(0) - C(h)
\item Diagonalize in standardized space: Γ_Y(h) = Σ(0)^(-1/2) Γ(h) Σ(0)^(-1/2)
\item Extract eigenvectors as MAF rotation
}
}

\strong{Result}: MAF factors Z = R * Y are ordered by eigenvalues
(high eigenvalue → high spatial variance → signal),
(low eigenvalue → low spatial variance → noise).
}
\examples{
\dontrun{
# Synthetic compositional data
set.seed(42)
sand <- rnorm(50, 60, 15)
silt <- rnorm(50, 25, 10)
clay <- 100 - sand - silt
data <- data.frame(x = rnorm(50), y = rnorm(50),
                   sand = pmax(0, sand), silt = pmax(0, silt),
                   clay = pmax(0, clay))

# ILR parameters and variogram
ilr_params <- gc_ilr_params(data[, c("sand", "silt", "clay")])
vgm_fit <- gc_fit_vgm(ilr_params, data, aggregate = TRUE)

# Compute MAF
maf_obj <- gc_compute_maf(ilr_params, list(vgm_fit, vgm_fit), lag_h = 10)

# MAF rotation matrix
print(maf_obj$rotation_matrix)
}

}
