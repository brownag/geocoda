% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/covariance_utilities.R
\name{gc_covariance_matrix}
\alias{gc_covariance_matrix}
\title{Build Multivariate Covariance Matrix at Specified Lag}
\usage{
gc_covariance_matrix(ilr_params, variogram_models, lag_h)
}
\arguments{
\item{ilr_params}{List from \code{\link[=gc_ilr_params]{gc_ilr_params()}} containing mean, cov, names}

\item{variogram_models}{List of fitted gstat vgm objects (one per ILR dimension)}

\item{lag_h}{Distance at which to evaluate covariances}
}
\value{
D×D covariance matrix at lag h, where D is the number of ILR dimensions
}
\description{
Construct the spatial covariance matrix between all ILR dimensions at distance lag_h.
Uses univariate covariances on diagonal and simplified approximation for off-diagonal terms.
}
\details{
\strong{Diagonal terms} C_ii(h) are computed directly from the univariate variogram
using \code{\link[=gc_vgm_to_cov]{gc_vgm_to_cov()}}.

\strong{Off-diagonal terms} C_ij(h) are approximated using:

\if{html}{\out{<div class="sourceCode">}}\preformatted{C_ij(h) ≈ C_ij(0) * sqrt(C_ii(h)/C_ii(0)) * sqrt(C_jj(h)/C_jj(0))
}\if{html}{\out{</div>}}

This assumes that the correlation structure between dimensions is relatively stable
across lags (i.e., dimensions that are correlated at lag 0 remain similarly correlated
at lag h). This is a simplification that works well when all dimensions have similar
spatial structure, but may underestimate cross-covariance if dimensions have very
different spatial ranges.
}
\examples{
\dontrun{
# ILR parameters from soil texture data
ilr_params <- gc_ilr_params(texture_data[, c("sand", "silt", "clay")])

# Fit variograms per dimension
vgm_list <- list(
  gc_fit_vgm(ilr_params, texture_data, aggregate = TRUE),
  gc_fit_vgm(ilr_params, texture_data, aggregate = TRUE)
)

# Covariance matrix at lag 50 (meters)
C_50 <- gc_covariance_matrix(ilr_params, vgm_list, lag_h = 50)
}

}
