% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hierarchical_zones.R
\name{gc_fit_hierarchical_model}
\alias{gc_fit_hierarchical_model}
\title{Fit Hierarchical Shrinkage Model to Zone Data}
\usage{
gc_fit_hierarchical_model(
  data,
  prior_spec,
  backend = "analytical",
  verbose = TRUE
)
}
\arguments{
\item{data}{Data frame with columns: zone (factor), ilr1, ilr2, ... (ILR values)}

\item{prior_spec}{An object of class \code{"gc_prior_spec"} (from \code{gc_set_hierarchy_priors()})}

\item{backend}{Character, fitting backend: \code{"analytical"} (default, fast shrinkage estimates),
\code{"stan"} (HMC MCMC, requires rstan), or \code{"nimble"} (adaptive MCMC, requires nimble)}

\item{verbose}{Logical, print estimation progress (default TRUE)}
}
\value{
An S3 object of class \code{"gc_hierarchical_fit"} containing:
\itemize{
\item \code{zone_estimates}: Zone-specific parameter estimates (mean, covariance)
\item \code{global_estimates}: Global parameter estimates (mean, covariance)
\item \code{samples}: Posterior samples (NULL for analytical, matrix for MCMC backends)
\item \code{diagnostics}: Backend-specific diagnostics
\item \code{prior_spec}: Original prior specification
\item \code{metadata}: Fitting information including backend and timestamp
}
}
\description{
Estimate zone-specific parameters using empirical Bayes shrinkage toward
a global mean. Zone estimates are pooled via weighted averaging, with the
strength of pooling controlled by \code{pooling_coefficient} in \code{gc_set_hierarchy_priors()}.
This method provides fast analytical estimates suitable for exploration,
visualization, and initial inference.
}
\details{
\strong{NOTE}: This is empirical Bayes shrinkage (analytical method). For full Bayesian
MCMC inference with posterior sampling, use \code{backend = "stan"} or \code{backend = "nimble"}
(requires installation of rstan or nimble packages respectively).
\subsection{Analytical Backend (default)}{

Fast empirical Bayes shrinkage method:
\enumerate{
\item Computes zone-specific maximum likelihood estimates (MLE)
\item Pools zone estimates toward global mean via weighted average
\item Shrinkage strength controlled by \code{pooling_coefficient} from priors
\item Closed-form analytical solution with no MCMC sampling
}

Shrinkage formula:

\if{html}{\out{<div class="sourceCode">}}\preformatted{mu[zone] = (1 - lambda) * mu_zone_MLE + lambda * mu_global
Sigma[zone] = [1 / (1 + n_zone * lambda)] * Sigma_zone_MLE
}\if{html}{\out{</div>}}

where \code{lambda = pooling_coefficient} from \code{gc_set_hierarchy_priors()}:
\itemize{
\item lambda = 0.0: No pooling (zone-specific only)
\item lambda = 0.05: Weak pooling
\item lambda = 0.2: Moderate pooling
\item lambda = 0.5: Strong pooling toward global
}

Suitable for quick exploration and visualization. For publication-quality Bayesian
inference with full posterior distributions, use Stan or Nimble backends.
}

\subsection{MCMC Backends (Stan, Nimble)}{

Full Bayesian inference with posterior sampling. Requires rstan or nimble to be installed:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{install.packages("rstan")  # For Stan backend
install.packages("nimble") # For Nimble backend
}\if{html}{\out{</div>}}
}
}
\examples{
\dontrun{
hierarchy <- gc_define_hierarchy(
  zone_names = c("Zone1", "Zone2", "Zone3"),
  component_names = c("sand", "silt", "clay")
)
priors <- gc_set_hierarchy_priors(hierarchy, pooling = "moderate")
data_zones <- data.frame(
  zone = rep(c("Zone1", "Zone2", "Zone3"), each = 5),
  ilr1 = rnorm(15), ilr2 = rnorm(15)
)

# Fast analytical shrinkage estimates (default)
fit_analytical <- gc_fit_hierarchical_model(data_zones, priors)
print(fit_analytical)

# Full MCMC inference with Stan (requires rstan)
# fit_stan <- gc_fit_hierarchical_model(data_zones, priors, backend = "stan")
}

}
