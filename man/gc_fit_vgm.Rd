% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/variogram_helpers.R
\name{gc_fit_vgm}
\alias{gc_fit_vgm}
\title{Optimize Variogram Parameters}
\usage{
gc_fit_vgm(
  ilr_params,
  data,
  vgm_model_type = "Exp",
  maxdist = NULL,
  width = NULL,
  aggregate = FALSE,
  correct.diagonal = 1.01,
  fit.ranges = FALSE
)
}
\arguments{
\item{ilr_params}{A list returned by \code{gc_ilr_params()}.}

\item{data}{A data frame or spatial object (sf) with columns \code{x}, \code{y} for
spatial coordinates and columns named \code{ilr1}, \code{ilr2}, etc., containing
ILR values at observed locations.}

\item{vgm_model_type}{Character string specifying variogram model type
(e.g., \code{"Exp"}, \code{"Sph"}, \code{"Gau"}). Default \code{"Exp"}.}

\item{maxdist}{Maximum distance for empirical variogram calculation
(default \code{NULL}, uses all pairs).}

\item{width}{Lag width for empirical variogram bins (default \code{NULL},
automatic).}

\item{aggregate}{Logical. If \code{TRUE}, aggregate fitted parameters across
ILR dimensions using weighted average sills (weights = covariance diagonal).
If \code{FALSE} (default), return per-dimension results.}

\item{correct.diagonal}{Numeric sill correction factor for LMC stability
(default \code{1.01}). Multiplies each marginal (diagonal) sill by this factor
to improve positive-definiteness of the LMC sill matrix and prevent
numerical issues. Recommended range: 1.00-1.05. Use \code{1.01} for typical applications.}

\item{fit.ranges}{Logical. If \code{FALSE} (default), fixes ranges to fitted values
during LMC construction to avoid over-parameterization. If \code{TRUE}, allows
range re-optimization when building LMC models.}
}
\value{
A list with:
\itemize{
\item If \code{aggregate = FALSE}: A list of length \code{D-1} where each element
contains \code{fitted_vgm} and \code{empirical_vgm} for that ILR dimension.
\item If \code{aggregate = TRUE}: A single \code{vgm} object with aggregated parameters
(mean range, weighted mean sill, weighted mean nugget).
\item Attribute \code{ilr_dimension_names}: Names of ILR dimensions (ilr1, ilr2, ...)
\item Attribute \code{fitted_params}: Data frame with per-dimension parameters
\item Attribute \code{lmc_admissibility}: Logical indicating if sill matrix is positive-definite
}
}
\description{
Fit empirical variograms to ILR values at observed locations and estimate
optimal variogram parameters for each ILR dimension. Results can be returned
per-dimension or aggregated into a single template variogram for use in
multivariate simulation. Includes diagnostics for LMC admissibility.
}
\details{
This function:
\enumerate{
\item For each ILR dimension i:
\itemize{
\item Computes empirical variogram using \code{gstat::variogram()}
\item Provides intelligent initial model (range ~ spatial extent / 3)
\item Fits parametric model using \code{gstat::fit.variogram()}
}
\item Optionally aggregates results using covariance-weighted averaging
\item Applies \code{correct.diagonal} to diagonal sills to ensure LMC positive-definiteness
}

Weighted aggregation combines results when building a single LMC model,
ensuring dimensions with higher variance contribute proportionally.

\strong{LMC Admissibility:}
The sill matrix (covariance at distance infinity) must be positive-definite for
valid spatial covariance. If eigenvalues of the sill matrix have any zero or
negative values, the LMC structure is inadmissible. The \code{correct.diagonal}
parameter helps stabilize the sill matrix by inflating diagonal terms,
which typically improves admissibility without distorting the model significantly.
}
\examples{
\dontrun{
# Example with observed ILR values on a spatial grid
library(gstat)

# Create sample data with spatial coordinates and ILR values
n_points <- 50
coords_df <- data.frame(
  x = runif(n_points, 0, 100),
  y = runif(n_points, 0, 100),
  ilr1 = rnorm(n_points, mean = 0.5, sd = 0.8),
  ilr2 = rnorm(n_points, mean = -0.2, sd = 0.6)
)

# Estimate parameters from bootstrap samples
samples <- data.frame(
  sand = c(20, 25, 30, 22),
  silt = c(60, 55, 50, 58),
  clay = c(20, 20, 20, 20)
)
params <- gc_ilr_params(samples)

# Fit empirical variograms
fitted <- gc_fit_vgm(
  params,
  coords_df,
  vgm_model_type = "Exp",
  aggregate = FALSE
)

# Or get single aggregated template
fitted_agg <- gc_fit_vgm(
  params,
  coords_df,
  vgm_model_type = "Exp",
  aggregate = TRUE
)
}

}
\references{
Deutsch, C. V., & Journel, A. G. (1992). GSLIB: Geostatistical Software Library and User's Guide.
Oxford University Press, New York.

Lark, R. M. (2009). Analysis of Differences in Kriged Loamy Clay Content Between Two Soil
Survey Datasets at Two Scales. \emph{Soil Science Society of America Journal}, 73(5), 1662-1672.
https://doi.org/10.2136/sssaj2008.0387
}
