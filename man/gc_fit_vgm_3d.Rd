% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/variogram_3d.R
\name{gc_fit_vgm_3d}
\alias{gc_fit_vgm_3d}
\title{Fit 3D Variogram with Geometric Anisotropy}
\usage{
gc_fit_vgm_3d(
  ilr_params,
  data,
  vgm_model_type = "Exp",
  horizontal_cutoff = NULL,
  vertical_cutoff = NULL,
  horizontal_width = NULL,
  vertical_width = NULL,
  aggregate = FALSE,
  correct.diagonal = 1.01,
  tolerance_z = 10,
  tolerance_xy = 50
)
}
\arguments{
\item{ilr_params}{Output from \code{\link[=gc_ilr_params]{gc_ilr_params()}}, containing mean and covariance}

\item{data}{Data frame with x, y, z coordinates plus ilr1, ilr2, ... columns}

\item{vgm_model_type}{Character: "Exp" (exponential), "Sph" (spherical), "Gau" (Gaussian)}

\item{horizontal_cutoff}{Distance (in xy-plane) for horizontal variogram (default: max xy distance / 2)}

\item{vertical_cutoff}{Distance (in z direction) for vertical variogram (default: max z distance / 2)}

\item{horizontal_width}{Lag width for horizontal variogram (default: auto)}

\item{vertical_width}{Lag width for vertical variogram (default: auto)}

\item{aggregate}{Logical: if TRUE, return single aggregated 3D vgm; if FALSE, return per-dimension (default: FALSE)}

\item{correct.diagonal}{Sill correction factor for LMC stability (default: 1.01)}

\item{tolerance_z}{Tolerance in z for computing horizontal variogram (cm, default: 10)}

\item{tolerance_xy}{Tolerance in xy for computing vertical variogram (m, default: 50)}
}
\value{
List containing:
\itemize{
\item \code{vgm_horizontal}: Fitted variogram for horizontal (xy) distances
\item \code{vgm_vertical}: Fitted variogram for vertical (z) distances
\item \code{range_horizontal}: Range parameter from horizontal variogram
\item \code{range_vertical}: Range parameter from vertical variogram
\item \code{anisotropy_ratio}: Ratio of horizontal to vertical range
\item \code{fitted_params}: Data frame with per-dimension parameters
\item Attributes: \code{ilr_dimension_names}, \code{model_type}, \code{coordinates_3d = TRUE}
}
}
\description{
Fits 3D variograms with explicit separation of horizontal and vertical spatial
continuity. Computes anisotropy ratio and directional information, critical
for modeling soil properties where lateral correlation ranges differ significantly
from vertical ranges (typical: horizontal >> vertical by 10-100×).
}
\details{
\strong{3D Variogram Strategy:}

Instead of fitting a full 3D variogram (which requires complex directional binning),
this function fits:
\enumerate{
\item \strong{Horizontal Variogram} (in xy-plane):
\itemize{
\item Pairs with similar z-values (within tolerance_z)
\item Describes lateral continuity independent of depth
\item Example: Sand content at 50-60 cm similar to sand at 40-50 cm in same location
}
\item \strong{Vertical Variogram} (in z-direction):
\itemize{
\item Pairs with similar xy-locations (within tolerance_xy)
\item Describes depth-dependent changes
\item Example: Sand content at 10 cm vs 50 cm in same profile location
}
}

\strong{Anisotropy:}
\itemize{
\item Computed as ratio: \code{anisotropy_ratio = range_horizontal / range_vertical}
\item Typical soil values: 10-100 (lateral continuity >> depth continuity)
\item In gstat: represented via \code{anis} parameter in 3D kriging
}

\strong{Geometric Anisotropy in 3D Kriging:}
The fitted 3D model enables gstat to compute covariance for lag vector (h_x, h_y, h_z):

\if{html}{\out{<div class="sourceCode">}}\preformatted{C_3D(h) = C_model(√(h_x² + h_y²) / a_h, h_z / a_v)
}\if{html}{\out{</div>}}

where \code{a_h} is horizontal range and \code{a_v} is vertical range.
}
\examples{
\\dontrun{
# Generate synthetic 3D soil data
data_3d <- expand.grid(
  x = seq(0, 1000, by = 100),
  y = seq(0, 1000, by = 100),
  z = seq(0, 100, by = 10)  # Depth in cm
)

# Create ILR-transformed compositional data
n <- nrow(data_3d)
data_3d$sand <- pmin(100, pmax(0, rnorm(n, 40, 15) - 0.3*data_3d$z))
data_3d$silt <- pmin(100, pmax(0, rnorm(n, 35, 15)))
data_3d$clay <- 100 - data_3d$sand - data_3d$silt

ilr_params <- gc_ilr_params(data_3d[, c("sand", "silt", "clay")])
data_3d <- cbind(data_3d, ilr_params$ilr_coords)

# Fit 3D variogram with anisotropy
vgm_3d <- gc_fit_vgm_3d(
  ilr_params, data_3d,
  vgm_model_type = "Exp",
  horizontal_cutoff = 500,
  vertical_cutoff = 50
)

# Inspect results
cat("Horizontal range:", vgm_3d$range_horizontal, "m\n")
cat("Vertical range:", vgm_3d$range_vertical, "cm\n")
cat("Anisotropy ratio (h/v):", vgm_3d$anisotropy_ratio, "\n")
}

}
