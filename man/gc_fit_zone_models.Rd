% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/zonal_simulation.R
\name{gc_fit_zone_models}
\alias{gc_fit_zone_models}
\title{Fit Geostatistical Models for Multiple Zones}
\usage{
gc_fit_zone_models(
  zone_data,
  model_type = "univariate",
  vgm_per_zone = TRUE,
  regional_vgm = NULL,
  skip_sparse = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{zone_data}{A list from \code{gc_prepare_zone_data()} with zone-specific samples.}

\item{model_type}{Character. Either \code{"univariate"} (default, numerically stable)
or \code{"lmc"} (Linear Model of Coregionalization, includes cross-covariance).}

\item{vgm_per_zone}{Logical. If TRUE (default), fit variogram separately per zone.
If FALSE, fit single regional variogram across all zones combined.}

\item{regional_vgm}{Optional \code{gstat::vgm()} object to use as template/prior for
all zones. Useful if zone-specific fitting is unreliable. Ignored if NULL.}

\item{skip_sparse}{Logical. If TRUE (default), skip zones with < 3 samples and
issue warning. If FALSE, attempt fitting anyway (may fail).}

\item{verbose}{Logical. Print progress messages (default TRUE).}
}
\value{
A list with structure matching \code{zone_data} (one element per zone),
where each zone element contains:
\itemize{
\item \code{ilr_params}: Output of \code{gc_ilr_params()}
\item \code{variogram}: Fitted \code{gstat::vgm()} object
\item \code{model}: Fitted \code{gstat} model object (from \code{gc_ilr_model()})
\item \code{fit_status}: Character, "success", "warning", or "skipped"
\item \code{fit_notes}: Character vector describing any issues
}

Class attribute: \code{"gc_zone_models"} for S3 method dispatch.
}
\description{
Build independent ILR-based geostatistical models for each zone using the
standard pipeline: \code{gc_ilr_params()} → \code{gc_fit_vgm()} → \code{gc_ilr_model()}.
}
\details{
\strong{Per-Zone Workflow:}
\enumerate{
\item Check sample count (if < 3, skip or warn per \code{skip_sparse})
\item Extract compositional columns and convert to ILR
\item Fit variogram to zone-specific or regional ILR dimensions
\item Build gstat model
\item Store with metadata
}

\strong{Sparse Zones (< 10 samples):}
\itemize{
\item If \code{vgm_per_zone=TRUE} and zone has < 5 samples, issue warning
\item Recommend switching to \code{vgm_per_zone=FALSE} (regional variogram)
\item If \code{regional_vgm} provided, use it as template
}

\strong{Regional Variogram Option:}
When \code{vgm_per_zone=FALSE}, combines all zone data to fit single variogram.
Useful when:
\itemize{
\item Many small zones with few samples each
\item Spatial structure is homogeneous across zones
\item Variogram estimation per zone is unstable
}
}
\examples{
\dontrun{
# Standard workflow: separate variogram per zone
zone_data <- gc_prepare_zone_data(samples, zones)
zone_models <- gc_fit_zone_models(zone_data)

# Check fit results
for (z_name in names(zone_models)) {
  zm <- zone_models[[z_name]]
  cat("Zone", z_name, ":", zm$fit_status, "\n")
  if (length(zm$fit_notes) > 0) cat("  Notes:", paste(zm$fit_notes, collapse="; "), "\n")
}

# For heterogeneous sample density: use regional variogram
zone_models <- gc_fit_zone_models(zone_data, vgm_per_zone = FALSE)
}

}
