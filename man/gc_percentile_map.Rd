% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/risk_assessment.R
\name{gc_percentile_map}
\alias{gc_percentile_map}
\title{Compute Percentile Maps from Simulations}
\usage{
gc_percentile_map(
  simulations,
  percentiles = c(0.1, 0.5, 0.9),
  component = NULL,
  na.rm = TRUE,
  names_format = "P{p}"
)
}
\arguments{
\item{simulations}{A \code{terra::SpatRaster} stack with multiple layers representing
simulation realizations.}

\item{percentiles}{Numeric vector in \link{0, 1} specifying which percentiles to compute.
Default: \code{c(0.1, 0.5, 0.9)} = \link{P10, P50, P90}
\itemize{
\item P10: 10th percentile (conservative low estimate, 90\% confidence of exceeding)
\item P50: Median / 50th percentile (central estimate)
\item P90: 90th percentile (conservative high estimate, only 10\% chance of exceeding)
}}

\item{component}{Character or integer vector. Which component(s) to analyze if
simulations are multi-component. NULL (default) = use all layers.}

\item{na.rm}{Logical. TRUE (default) = compute percentiles excluding NAs;
FALSE = return NA if any realization is NA at that location.}

\item{names_format}{Character string for output layer naming. Use \code{{p}} as
placeholder for percentile value.
\itemize{
\item Default: \code{"P{p}"} produces "P10", "P50", "P90"
\item Alternative: \code{"Q{p*100}"} produces "Q10", "Q50", "Q90"
}}
}
\value{
A \code{terra::SpatRaster} object with multiple layers (one per percentile).
Layer names indicate percentile (e.g., "P10", "P50", "P90").
Same extent and resolution as input.
}
\description{
Calculate percentile values (e.g., P10, P50, P90) at each grid cell from
simulation realizations. Useful for uncertainty visualization and decision-making.
}
\details{
\strong{Uncertainty Quantification:}

Percentiles provide conservative estimates for decision-making:
\itemize{
\item \strong{P90 (conservative high)}: For environmental standards, use if trying to be
protective (assume worst case)
\item \strong{P50 (median)}: Best estimate of central tendency
\item \strong{P10 (conservative low)}: For carbon credits, use to be conservative with
buyers (ensure deliver minimum promised)
}

\strong{Standard Uncertainty Band:}
The P10-P90 range encompasses 80\% of simulated outcomes and is commonly used
to visualize uncertainty.
}
\examples{
\dontshow{if (Sys.getenv("R_GEOCODA_RUN_EXAMPLES") == "true") withAutoprint(\{ # examplesIf}
# Create synthetic data
set.seed(42)
sims <- terra::rast(ncol = 10, nrow = 10, nlyr = 100)
terra::values(sims) <- rnorm(10000, mean = 50, sd = 15)

# Standard P10-P50-P90 band
perc_map <- gc_percentile_map(sims)

# Visualize uncertainty band
terra::plot(perc_map, main = "Soil Carbon Stock Uncertainty")

# More granular percentiles
percentiles <- gc_percentile_map(
  sims,
  percentiles = c(0.05, 0.25, 0.5, 0.75, 0.95)
)

# Calculate uncertainty band width
width <- perc_map[[3]] - perc_map[[1]]  # P90 - P10
terra::plot(width, main = "Uncertainty Band Width")
\dontshow{\}) # examplesIf}
}
