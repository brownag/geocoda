% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/zonal_simulation.R
\name{gc_prepare_zone_data}
\alias{gc_prepare_zone_data}
\title{Prepare Zone-Specific Compositional Data}
\usage{
gc_prepare_zone_data(
  data,
  zones,
  zone_id_column = NULL,
  min_samples = 3,
  verbose = FALSE
)
}
\arguments{
\item{data}{An sf object or data frame with sample coordinates, compositional columns,
and optional zone assignments. Must contain columns \code{x} and \code{y} for coordinates.}

\item{zones}{An sf object (polygons) with a \code{zone_id} column (unique zone identifiers),
or a \code{terra::SpatRaster} with cell values representing zone IDs (0 = nodata).}

\item{zone_id_column}{Character. Name of column in \code{data} containing zone assignments.
If NULL (default), performs spatial join between data and zones.}

\item{min_samples}{Numeric. Minimum samples required per zone (default 3).
Zones with fewer samples are flagged in output but not excluded.}
}
\value{
A list with one element per zone, containing:
\itemize{
\item \code{zone_id}: Unique zone identifier
\item \code{n_samples}: Number of samples in this zone
\item \code{data}: sf/data.frame with samples for this zone
\item \code{valid}: Logical, TRUE if n_samples >= min_samples
\item \code{bounds}: Bounding box (sf object or terra extent)
\item \code{warning_msgs}: Character vector of validation warnings (empty if none)
}

Class attribute: \code{"gc_zone_data"} for S3 method dispatch.
}
\description{
Extract compositional samples for each zone from a vector or raster zone layer.
Validates sample counts, spatial coverage, and compositional validity.
}
\details{
\strong{Workflow:}
\enumerate{
\item If \code{zone_id_column} is NULL, performs spatial join via \code{sf::st_join()}
\item Groups samples by zone_id
\item For each zone, validates:
\itemize{
\item Sample count >= min_samples
\item No missing values in compositional columns
\item Compositional sums between 95-105 (assuming 100-sum compositions)
}
\item Computes zone extent (bounding box)
}

\strong{Warnings Issued:}
\itemize{
\item Zone has < 5 samples: variogram fitting may be unreliable
\item Zone has < 10 samples: recommend pooled regional variogram
\item Compositional samples outside normal range (95-105)
\item No samples in zone boundary (if zones provided as raster)
}
}
\examples{
\dontrun{
# Load sample data and zone polygons
samples <- sf::st_read("soil_samples.shp")
zones <- sf::st_read("mapunits.shp")

# Prepare zone data (spatial join)
zone_data <- gc_prepare_zone_data(samples, zones)

# Check validation results
for (z in zone_data) {
  cat("Zone", z$zone_id, ":", z$n_samples, "samples\n")
  if (!z$valid) cat("  WARNING:", z$warning_msgs, "\n")
}

# If zone_id already in samples:
zone_data <- gc_prepare_zone_data(samples, zones, zone_id_column = "mapunit_id")
}

}
