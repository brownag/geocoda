% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/risk_assessment.R
\name{gc_probability_map}
\alias{gc_probability_map}
\title{Compute Probability of Exceeding Threshold}
\usage{
gc_probability_map(
  simulations,
  threshold,
  operator = ">",
  component = NULL,
  na.rm = TRUE
)
}
\arguments{
\item{simulations}{A \code{terra::SpatRaster} stack with multiple layers representing
different simulation realizations of the same variable(s). Each layer is one
realization; values are in the original scale (after ILR back-transform if
compositional data).}

\item{threshold}{Numeric value or named list specifying threshold(s) to compare.
\itemize{
\item Single numeric: Applied to all layers
\item Named list (e.g., \code{list(sand = 20, clay = 30)}): Component-specific thresholds
(for multi-component simulations)
}}

\item{operator}{Character specifying comparison operator.
\itemize{
\item \code{">"} (default): Probability of exceeding threshold (Z > t)
\item \code{">="}: P(Z ≥ t)
\item \code{"<"}: Probability below threshold (Z < t)
\item \code{"<="}: P(Z ≤ t)
\item \code{"=="}: Probability of exact equality (rarely used)
}}

\item{component}{Character or integer vector. If simulations contain multiple
components (e.g., sand, silt, clay as separate layers), which component(s) to
analyze.
\itemize{
\item NULL (default): Use all layers
\item Single value: Extract one component
\item Vector: Multiple components (computes per-component probability)
}}

\item{na.rm}{Logical. How to handle NA values in the realization stack.
\itemize{
\item TRUE (default): P(Z_valid > t) - compute probability excluding NAs
\item FALSE: Propagate NA to output if any realization is NA
}}
}
\value{
A \code{terra::SpatRaster} object with a single layer representing
probability values in \link{0, 1} at each spatial location. Layer is named
\code{"probability"} by default. Same extent and resolution as input \code{simulations}.
}
\description{
Calculate probability that simulated values exceed a specified threshold at each
spatial location. Uses indicator functions on simulation realizations to estimate
empirical probabilities.
}
\details{
\strong{Probability Calculation:}

At each grid cell, the function counts how many realizations satisfy the
threshold condition and divides by total number of realizations:

\deqn{P(s) = \frac{\#\{Z(s)_k > t\}}{n}}

Where n = number of simulation realizations.

\strong{Interpretation:}
\itemize{
\item P = 0.9: 90\% of simulations exceed threshold (high confidence of occurrence)
\item P = 0.5: 50\% of simulations exceed threshold (maximum uncertainty)
\item P = 0.1: 10\% of simulations exceed threshold (low probability of occurrence)
}

\strong{Common Applications:}
\itemize{
\item Carbon credit eligibility: P(SOC > 50 Mg/ha)
\item Contamination risk: P(Pb > 300 mg/kg)
\item Agronomic suitability: P(clay < 40\%)
}
}
\examples{
\dontshow{if (Sys.getenv("R_GEOCODA_RUN_EXAMPLES") == "true") withAutoprint(\{ # examplesIf}
# Create synthetic data for demonstration
set.seed(42)
sims <- terra::rast(ncol = 10, nrow = 10, nlyr = 50)
terra::values(sims) <- rnorm(5000, mean = 50, sd = 15)

# Probability of exceeding 50 Mg/ha
prob_map <- gc_probability_map(sims, threshold = 50)
terra::plot(prob_map, main = "P(SOC > 50 Mg/ha)")

# Conservative estimate (use >= operator for credit eligibility)
prob_credit <- gc_probability_map(
  sims,
  threshold = 50,
  operator = ">="
)
\dontshow{\}) # examplesIf}
}
