% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_sources.R
\name{gc_ssurgo_to_params}
\alias{gc_ssurgo_to_params}
\title{Convert Soil Component Data to Composition Parameters}
\usage{
gc_ssurgo_to_params(
  x,
  weight_method = "comppct",
  weight_col = NULL,
  depth_range = NULL,
  target_sum = 100,
  agg_method = "weighted_mean",
  percentile = 50,
  verbose = FALSE
)
}
\arguments{
\item{x}{Data frame with soil component data. Must contain:
\itemize{
\item \code{mukey} (character/numeric): map unit key, identifies soil mapping unit
\item \code{cokey} (character/numeric): component key, identifies soil component
\item \code{comppct} (numeric): percent of map unit occupied by component (0-100)
\item \code{sandtotal} (numeric): sand content (\%)
\item \code{silttotal} (numeric): silt content (\%)
\item \code{claytotal} (numeric): clay content (\%)
\item \code{hzdept_r} (numeric, optional): depth to top of horizon (cm)
\item \code{hzdepb_r} (numeric, optional): depth to bottom of horizon (cm)
}}

\item{weight_method}{Character, aggregation weight method for components:
\itemize{
\item "comppct" (default): weight by component percent (comppct)
\item "area": equal weight to all components in map unit
\item "custom": use external weight column
}}

\item{weight_col}{Character, name of weight column (only if weight_method = "custom")}

\item{depth_range}{Numeric vector c(min_depth, max_depth) in cm to filter horizons.
If NULL (default), uses all horizons.}

\item{target_sum}{Numeric, target sum for compositions (default 100)}

\item{agg_method}{Character, aggregation method by map unit:
\itemize{
\item "weighted_mean" (default): weighted mean across components
\item "percentile": use specified percentile (e.g., "p50" for median)
}}

\item{percentile}{Numeric (0-100), percentile to use if agg_method = "percentile"}

\item{verbose}{Logical, report processing steps (default FALSE)}
}
\value{
List with elements:
\itemize{
\item \code{constraints}: Map unit-level constraints (min, representative, max)
\item \code{samples}: Point-level component samples (unweighted)
\item \code{samples_weighted}: Component samples with weights applied
\item \code{mu_stats}: Summary statistics by map unit
\item \code{metadata}: Processing metadata (source, method, depth_range, n_records)
\item \code{input_data}: Original input data for reference
}
}
\description{
Transform soil component data (sand, silt, clay percentages) from any source
into constraint and samples for simulation. Aggregates multiple components per
map unit using specified weighting scheme.
}
\details{
The constraint bounds are derived from:
\itemize{
\item Minimum: 10th percentile across all components
\item Representative: Weighted mean of component percentages
\item Maximum: 90th percentile across all components
}

This approach preserves spatial and component heterogeneity while providing
realistic bounds for the simulation domain.
}
\examples{
# Soil component data from any source (SSURGO, SDA, NASIS, CSV, etc.)
soil_data <- data.frame(
  mukey = c(rep(1001, 3), rep(1002, 2)),
  cokey = c(1001.1, 1001.2, 1001.3, 1002.1, 1002.2),
  comppct = c(60, 25, 15, 50, 50),
  sandtotal = c(35, 15, 50, 40, 20),
  silttotal = c(50, 60, 30, 45, 65),
  claytotal = c(15, 25, 20, 15, 15),
  hzdept_r = c(0, 0, 0, 0, 0),
  hzdepb_r = c(25, 25, 25, 25, 25)
)

# Convert to parameters
params <- gc_ssurgo_to_params(
  soil_data,
  weight_method = "comppct",
  depth_range = c(0, 25)
)

# Extract constraints for simulation
constraints <- params$constraints

}
