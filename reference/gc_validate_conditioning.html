<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Validate Conditional Simulation Data Honoring — gc_validate_conditioning • geocoda</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validate Conditional Simulation Data Honoring — gc_validate_conditioning"><meta name="description" content="Assess the quality and accuracy of conditional kriging by extracting
kriged predictions at the conditioning (observation) locations and comparing
them to the actual observed values. This provides a quantitative measure of
how well the model honors the conditioning data in ILR space."><meta property="og:description" content="Assess the quality and accuracy of conditional kriging by extracting
kriged predictions at the conditioning (observation) locations and comparing
them to the actual observed values. This provides a quantitative measure of
how well the model honors the conditioning data in ILR space."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">geocoda</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/soil_texture_workflow.html">Soil Texture Workflow</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Validate Conditional Simulation Data Honoring</h1>

      <div class="d-none name"><code>gc_validate_conditioning.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Assess the quality and accuracy of conditional kriging by extracting
kriged predictions at the conditioning (observation) locations and comparing
them to the actual observed values. This provides a quantitative measure of
how well the model honors the conditioning data in ILR space.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gc_validate_conditioning</span><span class="op">(</span></span>
<span>  <span class="va">model</span>,</span>
<span>  <span class="va">observed_data</span>,</span>
<span>  metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rmse"</span>, <span class="st">"mae"</span>, <span class="st">"mean_error"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A gstat kriging model (typically from <code><a href="gc_ilr_model.html">gc_ilr_model()</a></code>) that was
built with conditioning data via the <code>data</code> parameter. The model must contain
observed ILR values at sample locations.</p></dd>


<dt id="arg-observed-data">observed_data<a class="anchor" aria-label="anchor" href="#arg-observed-data"></a></dt>
<dd><p>A data frame or sf object with the original conditioning
data, containing columns <code>x</code>, <code>y</code> for spatial coordinates and columns <code>ilr1</code>,
<code>ilr2</code>, etc., with ILR values in the same space as the model.</p></dd>


<dt id="arg-metrics">metrics<a class="anchor" aria-label="anchor" href="#arg-metrics"></a></dt>
<dd><p>Character vector specifying which error metrics to compute.
Default <code>c("rmse", "mae", "mean_error")</code>. Options include:</p><ul><li><p><code>"rmse"</code>: Root mean squared error</p></li>
<li><p><code>"mae"</code>: Mean absolute error</p></li>
<li><p><code>"mean_error"</code>: Mean signed error (bias)</p></li>
<li><p><code>"median_error"</code>: Median absolute error</p></li>
<li><p><code>"sd_error"</code>: Standard deviation of errors</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing:</p><ul><li><p><code>predictions_at_obs</code>: Data frame with kriged predictions at each observation location</p></li>
<li><p><code>observed_values</code>: Data frame with original observed ILR values</p></li>
<li><p><code>residuals</code>: Difference (observed - predicted) for each ILR dimension</p></li>
<li><p><code>error_metrics</code>: Data frame with error statistics (one row per ILR dimension)</p></li>
<li><p><code>overall_metrics</code>: Data frame with aggregated error statistics across all dimensions</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Conditional Honoring Assessment:</strong></p>
<p>Conditional kriging is intended to provide spatial predictions that exactly
(or very nearly) match observed values at the conditioning locations.
In practice, numerical precision limits and kriging discretization may result
in small residuals even for perfectly honored data.</p>
<p>This function:</p><ol><li><p>Extracts kriged predictions at each observation location using the model</p></li>
<li><p>Computes residuals (observed minus predicted) for each ILR dimension</p></li>
<li><p>Calculates error metrics (RMSE, MAE, etc.) per dimension and overall</p></li>
<li><p>Returns detailed diagnostics for reviewing data honoring quality</p></li>
</ol><p><strong>Interpretation:</strong></p><ul><li><p>RMSE close to zero indicates excellent data honoring</p></li>
<li><p>Mean error close to zero indicates unbiased predictions</p></li>
<li><p>Non-zero residuals may indicate:</p><ul><li><p>Numerical precision effects (typically &lt; 1e-10)</p></li>
<li><p>Model convergence issues (investigate with univariate kriging)</p></li>
<li><p>Grid resolution effects (predictions on coarse grids may miss exact locations)</p></li>
</ul></li>
</ul><p>For compositional data (original sand/silt/clay), back-transform RMSE in ILR
space to composition space using <code>ilrInv()</code> to assess error in original units.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Assuming model and observed_data are available from gc_ilr_model()</span></span></span>
<span class="r-in"><span><span class="co"># and original data frame with spatial coordinates</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Build model with conditioning data</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="gc_ilr_model.html">gc_ilr_model</a></span><span class="op">(</span><span class="va">ilr_params</span>, data <span class="op">=</span> <span class="va">conditioning_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Validate conditioning</span></span></span>
<span class="r-in"><span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu">gc_validate_conditioning</span><span class="op">(</span><span class="va">model</span>, <span class="va">conditioning_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Review error metrics</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">error_metrics</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">overall_metrics</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check for problematic observations</span></span></span>
<span class="r-in"><span><span class="va">high_residuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">residuals</span><span class="op">$</span><span class="va">ilr1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">high_residuals</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Observations with large residuals:"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">residuals</span><span class="op">[</span><span class="va">high_residuals</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualize residuals vs spatial location</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">predictions_at_obs</span><span class="op">$</span><span class="va">x</span>,</span></span>
<span class="r-in"><span>     <span class="va">validation</span><span class="op">$</span><span class="va">residuals</span><span class="op">$</span><span class="va">ilr1</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="st">"ILR1 Residuals vs X Coordinate"</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"X"</span>, ylab <span class="op">=</span> <span class="st">"Residual (Observed - Predicted)"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrew Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

